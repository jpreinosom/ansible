---
- name: Generar informe de vulnerabilidades y generar PDF
  hosts: local
  become: yes
  tasks:

    - name: Copiar el archivo import_requests.py desde el proyecto Ansible Automation Platform
      copy:
        src: python/import_requests.py
        dest: /tmp/import_requests.py
        mode: '0755'

    - name: Copiar el archivo info.py desde el proyecto Ansible Automation Platform
      copy:
        src: python/info.py
        dest: /tmp/info.py
        mode: '0755'

    - name: Copiar el archivo ejemplo.adoc desde el proyecto Ansible Automation Platform
      copy:
        src: ejemplo.adoc
        dest: /tmp/ejemplo.adoc
        mode: '0644'

    - name: Ejecutar el script import_requests.py para generar archivos ASCII Doctor de vulnerabilidades
      command: python3 /tmp/import_requests.py
      args:
        chdir: /tmp  # Ejecutar el script desde /tmp donde fue copiado

    - name: Ejecutar el script info.py para obtener im√°genes desde Grafana
      command: python3 /tmp/info.py
      args:
        chdir: /tmp  # Ejecutar el script desde /tmp donde fue copiado

    - name: Generar PDF con ruta absoluta
      command: /home/ansible/bin/asciidoctor-pdf /tmp/ejemplo.adoc
      environment:
        GEM_PATH: "/home/ansible/.local/share/gem/ruby:/usr/share/gems:/usr/local/share/gems"
        GEM_HOME: "/home/ansible/.local/share/gem/ruby"

    - name: Mover el PDF generado al directorio /home/ansible/resultado
      command: mv /tmp/ejemplo.pdf /home/ansible/resultado/ejemplo.pdf

    - name: Limpiar el contenido de /tmp sin borrar el directorio
      shell: rm -rf /tmp/*
      warn: no
      ignore_errors: yes
...